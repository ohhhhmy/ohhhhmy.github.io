---
layout: post
title:  "오늘의 일지"
date:   2021-01-21
author: MYOH(최은오)
categories: WinterInternship
---



1. 교육관리 탭에서 수정 기능을 구현했습니다.

   수정에 대한 요구사항은 다음과 같습니다.

   - 수정은 본인과 본인이 속한 팀의 팀장 및 실장만 가능하다.  
   - 총 이수 시간을 알 수 있어야 한다.
   - 수정할 때에는 당시에 이수한 교육 시간을 입력한다(자기가 직접 총 이수 시간을 구하지 X)

   추가적으로 숫자가 아닌 값을 입력할 경우 예외처리를 해줘야 하고 총 이수 시간이 할당 시간을 넘어서는 안됩니다. 충족해야 할 조건이 다양하니 차근차근 작업했습니다.

2. 본인

   detail 페이지에서 누구누구의 교육 현황이라는 제목을 띄우기 위해 파라미터로 받아온 id 값의 이름을 조회하는 절차를 거칩니다. 만약 제 ID가 myoh라면 url은 .../education/education_detail.jsp?id=myoh 이런 식이라는 겁니다.  

   이 id 값으로 member 테이블에서 해당 id를 가진 사람을 조회한 후 이름을 받아와 표시하는데 수정 버튼을 눌렀을 때 본인인지 확인하는 것은 현재 로그인 된 sessionID와 파라미터로 넘겨온 ID를 비교해 일치할 경우 수정 페이지로 이동할 수 있게 하였습니다.  

3. 팀의 팀장 및 실장

   이것은 sessionID를 기반으로 member 테이블에서 조회해 직책 정보를 가져온 후 파라미터로 넘겨받은 id의 멤버가 속한 팀인지, 그리고 sessionID로 조회한 그 사람의 직책이 팀장인지, 혹은 실장인지를 확인했습니다.  

4. 총 이수 시간

   교육 관리를 위해 새로 제작한 education 테이블에서 이수시간은 총 이수시간을 의미하기에 사용자가 수정 페이지에서 새롭게 입력한 이수 시간은 자바 변수에 저장한 후 update할 때 메서드에 같이 넘겨 DB에 저장되어있는 기존의 총 이수 시간에 해당 값을 더하여 저장했습니다.

5. update, 조심해서 해야 하는 이유

   마요가 수정하려는 교육 이수 현황을 예로 들어보겠습니다.  

   - 교육명 : 웹 개발 교육
   - 일정 : 2021-01-25
   - 이수 시간 : 0
   - 할당 시간 : 8

   마요가 교육을 2시간 들어서 이수 시간을 2로 수정해야합니다. 그런데 education 테이블은 id와 교육명, 일정이 PK입니다. 그럼 update하는 쿼리문의 형태는 어떻게 될까요?  

   update나 delete처럼 한 가지 row만 변경해야 하는 경우는 특히나 조건을 신중하게 달아야합니다. 그렇지 않으면 의도치 않게 여러 개의 row를 변경시켜버리는 사태가 일어날 수 있으니까요.  

   사용자가 어떠한 정보를 바꿨는지 특정하여 알 수 없기 때문에 update문에는 모든 field를 다 쓰겠습니다.  

   `update education set 교육명 = '웹 개발 교육', 일정='2021-01-25', 이수시간=2, 할당시간=8 where id='myoh' and 교육명='웹 개발 교육' and 일정='2021-01-25';`   

   쿼리문이 위와 같습니다. 교육명과 일정은 set에도 들어가고 where 조건에도 넣어야 합니다. set에는 변경할 데이터가, where에는 이전 데이터가 들어간다는 차이가 있습니다. 그렇다면 update하는 메서드를 호출해 update하고자 할 때 변경할 데이터만 넣으면 될까요? 이전 데이터도 필요합니다. 그래야 한 가지 row를 특정해 변경할 수 있으니까요. 그래서 변경 전 교육명과 일정을 조회한 후 update하는 메서드에 인자로 넘겨줘야 합니다.  

   처음에 where조건에서 쓴 컬럼을 변경할 수 있나 의문이 들었습니다만 돌려보니 잘 변경이 되더군요. 교육 이수 현황을 수정하는 메서드를 위의 쿼리문을 활용해 제작했습니다.

6. 예외 처리

   숫자가 아닌 문자가 들어왔을 경우 IllegalArgumentException 예외가 발생합니다. 이수 시간과 할당 시간, 그리고 총 이수 시간이 파라미터로 넘어올 때에는 String으로 넘어오기 때문에 총 이수 시간이 할당 시간을 초과하는지 확인하기 위해서는 정수형으로 해당 데이터들을 바꿔줘야 합니다. 그런데 숫자가 아닌 문자, 예를 들어 ㅓ 같은 것이 넘어오면 해당 예외가 발생합니다. 예외 처리는 간단하게 alert() 창을 띄워 해결했습니다.  